<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - Events Controls</title>
		<meta charset="utf-8">
		<style>
			body {
				margin: 0px;
				color: #fff;
				font-family:Monospace;
				text-align: center;
				font-size: 15px;
				line-height: 30px;
				overflow: hidden;
			}
			#info {
				position: absolute;
				top: 0px; width: 200px;
				padding: 5px;
				z-index:0;
			}		
			
		</style>
	</head>
	<body>
		<div id="info">
			<a href="http://threejs.org" target="_blank">three.js</a> EventsControls (look console)
		</div>

		<script src="../build/three.min.js"></script>

		<script src="js/libs/stats.min.js"></script>
	
		<script src="js/controls/EventsControls.js"></script>

		<script>


			var camera, scene, renderer, controls;
				var vectors=[];
			
			
			init();
			animate();

			function init() {

				renderer = new THREE.WebGLRenderer( { antialias: true } ); 
				//renderer.setClearColor( 0xFFFFFF );
				renderer.setSize( window.innerWidth, window.innerHeight );				
				document.body.appendChild( renderer.domElement );

				//

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				stats.domElement.style.zIndex = 100;
				document.body.appendChild( stats.domElement );

				//

				var showResult = document.createElement('div');
				showResult.style.position = 'absolute';
				showResult.style.top = '100px';
				showResult.style.width = '300px';
				showResult.style.fontSize = '16px';
				showResult.style.zIndex = 101;
				showResult.innerHTML = 'Кликните для получения результата!';
				showResult.addEventListener("click", function(){
					var sssr = "", st = "";
					for ( var i = 0; i < vectors.length; i++ ) {

						st = 'vectors[' + i + '] = new THREE.Vector3(' + EventsControls.objects[i].position.x + ',' +
							EventsControls.objects[i].position.y + ',' + EventsControls.objects[i].position.z + ');\n';
						sssr = sssr + st;
					}		
					
					//showResult.innerHTML = sssr;
					console.log( sssr );
					
				});
				
				document.body.appendChild( showResult );				
				//
				
				camera = new THREE.PerspectiveCamera( 30, window.innerWidth / window.innerHeight, 1, 3000 );
				camera.position.set( 0, 0, 1100 );
				camera.lookAt( new THREE.Vector3( 0, -200, 0 ) );

				scene = new THREE.Scene();

				var light = new THREE.DirectionalLight( 0xffffff, 1 );
				light.position.set( 0, 500, 1000 );
				scene.add( light );

				var light = new THREE.AmbientLight( 0x222222 );
				scene.add( light );


				// world
				
				var Texture = new THREE.ImageUtils.loadTexture( 'textures/city2.png' );				
				Texture.wrapS = Texture.wrapT = THREE.RepeatWrapping;

				var Material = new THREE.MeshBasicMaterial( { map: Texture, side: THREE.DoubleSide } );
			//var Material = new THREE.MeshBasicMaterial( { color:  0xFFFFFF, side: THREE.DoubleSide } );				
				var Geometry = new THREE.PlaneGeometry( 1024, 1024, 1, 1 );

				var checkerboard = new THREE.Mesh( Geometry, Material );
				scene.add( checkerboard );


				EventsControls = new EventsControls( camera, renderer.domElement );
				EventsControls.map = checkerboard;
				EventsControls.attachEvent( 'mouseOver', function () {

					this.container.style.cursor = 'pointer';
					console.log( 'the key at number ' + this.event.item + ' is select' );


				});

				EventsControls.attachEvent( 'mouseOut', function () {

					this.container.style.cursor = 'auto';

				});

				EventsControls.attachEvent( 'dragAndDrop', function () {

					this.container.style.cursor = 'move';
					this.focused.position.x = Math.round( ( this.focused.position.x ) );
					this.focused.position.y = Math.round( ( this.focused.position.y ) );
					

				});

				EventsControls.attachEvent( 'mouseUp', function () {

					this.container.style.cursor = 'auto';

				});

					vectors[0] = new THREE.Vector3(-211,309,0);
					vectors[1] = new THREE.Vector3(-125,253,0);
					vectors[2] = new THREE.Vector3(-109,246,0);
					vectors[3] = new THREE.Vector3(-93,245,0);
					vectors[4] = new THREE.Vector3(-78,252,0);



				for ( var i = 0; i < 26; i++ ) {
					vectors[i] = new THREE.Vector3(  i * 19-200, -300, 0 ); 
				}				
				
				var Circmaterial = new THREE.MeshBasicMaterial( {color: 0xff000f} );
				var Circgeometry = new THREE.CircleGeometry(4, 32 );	


				for ( var i = 0; i < vectors.length; i++ ) {

					var krugok = new THREE.Mesh(Circgeometry, Circmaterial);
					krugok.position.copy( vectors[i] );krugok.position.z = 0;
					scene.add( krugok ); 
					EventsControls.attach( krugok );

				}
					var sssr = "", st = "";
					for ( var i = 0; i < vectors.length; i++ ) {

						st = 'vectors[' + i + '] = new THREE.Vector3(' + EventsControls.objects[i].position.x + ',' +
							EventsControls.objects[i].position.y + ');\n';
							sssr = sssr + st;
					}
				console.log('------------------------------------');				
				console.log(sssr);
				
				
				
				
				//
				
					var californiaPts0 = []; 
				for ( var i = 0; i < vectors.length; i++ ) {

					var vector = vectors[i].clone();
					californiaPts0.push( vector.multiplyScalar(1.4) );

				}
				
				var californiaShape = new THREE.Shape( californiaPts0 );

					var geometry = new THREE.ShapeGeometry( californiaShape );

					var mesh = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial( { color: 0x464646, side: THREE.DoubleSide } ) );
					mesh.position.set( 45, 0, 0 );
					//mesh.rotation.set( rx, ry, rz );
					//mesh.scale.set( s, s, s );
					//scene.add( mesh );				
				
				
					var californiaPts = []; 
				for ( var i = 0; i < vectors.length; i++ ) {

					var vector = vectors[i].clone();
					californiaPts.push( vector.multiplyScalar(1.2) );

				}
				
				var californiaShape = new THREE.Shape( californiaPts );

					var geometry = new THREE.ShapeGeometry( californiaShape );

					var mesh = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial( { color: 0x424242, side: THREE.DoubleSide } ) );
					mesh.position.set( 25, 0, 0 );
					//mesh.rotation.set( rx, ry, rz );
					//mesh.scale.set( s, s, s );
					//scene.add( mesh );
		

				var californiaPts2 = []; 
				for ( var i = 0; i < vectors.length; i++ ) {

					var vector = vectors[i].clone();
					californiaPts2.push( vector.multiplyScalar(1) );

				}
				
				var californiaShape = new THREE.Shape( californiaPts2 );

					var geometry = new THREE.ShapeGeometry( californiaShape );

					var mesh = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial( { color: 0x363636, side: THREE.DoubleSide } ) );
					var mesh = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial( { color: 0x000000, side: THREE.DoubleSide } ) );					
					
					mesh.position.set( 0, 0, 0 );
					//mesh.rotation.set( rx, ry, rz );
					//mesh.scale.set( s, s, s );
					//scene.add( mesh );					

					
					vectors[0] = new THREE.Vector3(-39,-126,0);
					vectors[1] = new THREE.Vector3(-68,-127,0);
					vectors[2] = new THREE.Vector3(-94,-123,0);
					vectors[3] = new THREE.Vector3(-115,-110,0);
					vectors[4] = new THREE.Vector3(-138,-97,0);
					vectors[5] = new THREE.Vector3(-158,-81,0);
					vectors[6] = new THREE.Vector3(-177,-68,0);
					vectors[7] = new THREE.Vector3(-192,-50,0);
					vectors[8] = new THREE.Vector3(-202,-27,0);
					vectors[9] = new THREE.Vector3(-213,-5,0);
					vectors[10] = new THREE.Vector3(-215,23,0);
					vectors[11] = new THREE.Vector3(-213,46,0);
					vectors[12] = new THREE.Vector3(-208,66,0);
					vectors[13] = new THREE.Vector3(-205,91,0);
					vectors[14] = new THREE.Vector3(-193,114,0);
					vectors[15] = new THREE.Vector3(-183,134,0);
					vectors[16] = new THREE.Vector3(-168,153,0);
					vectors[17] = new THREE.Vector3(-152,174,0);
					vectors[18] = new THREE.Vector3(-135,192,0);
					vectors[19] = new THREE.Vector3(-113,203,0);
					vectors[20] = new THREE.Vector3(-96,191,0);
					vectors[21] = new THREE.Vector3(-70,191,0);
					vectors[22] = new THREE.Vector3(-52,181,0);
					vectors[23] = new THREE.Vector3(-39,168,0);
					
				var arrSpline = [];
				
				for ( var i = 0; i < 24; i++ ) {

					var vector = vectors[i].clone();
					arrSpline.push( vector );

				}		
				
				spline = new THREE.SplineCurve3( arrSpline );
				var tubegeo = new THREE.TubeGeometry( spline, 128, 1, 12 );
				var material = new THREE.MeshLambertMaterial( { 
						color: 0x9b2d30,
				} );
				
				var tube = new THREE.Mesh( tubegeo, material );
				scene.add( tube );


					
				
				
				window.addEventListener( 'resize', onWindowResize, false );


			}

			function onWindowResize() {
			
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );

			}


			function animate() {

					requestAnimationFrame(animate);
					render();

			}


			function render() {

					stats.update();

					EventsControls.update();
					renderer.render(scene, camera);

			}

		</script>

	</body>
</html>
